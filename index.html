<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜³æ˜ä¾ æ¯æ—¥ä¸€è¯´ - ç›´æ’­æ¨¡æ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        
        .mobile-live-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ä¸Šéƒ¨ï¼šäº¤æ˜“çœ‹æ¿ - å 60% */
        .trading-section {
            height: 60vh;
            position: relative;
            z-index: 10;
        }
        
        /* é»‘è‰²é®ç½©æ–¹å— - æ–°å¢ */
        .mask-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 15; /* ç¡®ä¿åœ¨iframeä¸Šæ–¹ */
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: move;
            resize: both;
            overflow: auto;
            min-width: 80px;
            min-height: 40px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        /* é®ç½©æ§åˆ¶æŒ‰é’® */
        .mask-controls {
            position: absolute;
            bottom: -30px;
            left: 0;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .mask-overlay:hover .mask-controls {
            opacity: 1;
        }
        
        .mask-btn {
            background: rgba(78, 205, 196, 0.8);
            border: none;
            border-radius: 3px;
            color: white;
            padding: 2px 6px;
            font-size: 0.7em;
            cursor: pointer;
        }
        
        .mask-btn:hover {
            background: rgba(78, 205, 196, 1);
        }
        
        /* ä¸­éƒ¨ï¼šæ–°é—»æ»šåŠ¨æ¡ - ç²¾ç®€é«˜åº¦ */
        .news-section {
            height: 6vh;
            background: rgba(255, 255, 255, 0.03);
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            z-index: 5;
        }
        
        .news-scroll-container {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .news-content {
            position: absolute;
            white-space: nowrap;
            animation: scrollNews 25s linear infinite;
        }
        
        .news-item {
            display: inline-block;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            padding: 3px 12px;
            border-radius: 12px;
            margin-right: 15px;
            border-left: 2px solid #4ecdc4;
        }
        
        .news-title {
            font-size: 0.75em;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        @keyframes scrollNews {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* ä¸‹éƒ¨ï¼šå†…å®¹åŒºåŸŸ - å 34% */
        .content-section {
            height: 34vh;
            background: rgba(10, 10, 20, 0.85);
            position: relative;
            padding: 15px;
            z-index: 8;
        }
        
        /* é˜³æ˜ä¾ æ ‡é¢˜ - å·¦ä¸Šè§’ç´§å‡‘è®¾è®¡ */
        .saying-header {
            position: absolute;
            top: 10px;
            left: 15px;
            z-index: 20;
        }
        
        .saying-title {
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ - æ›´å¤§çš„æ˜¾ç¤ºç©ºé—´ */
        .saying-content {
            font-size: 1.3em;
            color: #f8f8f8;
            line-height: 1.6;
            text-align: center;
            padding: 50px 20px 20px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(78, 205, 196, 0.3);
            min-height: calc(34vh - 40px);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }
        
        /* é˜³æ˜ä¾ å¤´åƒåŒºåŸŸ - ä½¿ç”¨AIç”Ÿæˆçš„çœŸå®æ„Ÿå¤´åƒ */
        .ai-character {
            position: absolute;
            right: 20px;
            bottom: 20px;
            text-align: center;
            width: 100px;
        }
        
        .ai-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
            overflow: hidden;
            background: #2c3e50;
        }
        
        .ai-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(45deg, #34495e, #2c3e50);
        }
        
        .ai-name {
            font-size: 1em;
            font-weight: bold;
            color: #4ecdc4;
            text-shadow: 0 0 6px rgba(78, 205, 196, 0.4);
        }
        
        .speech-status {
            position: absolute;
            bottom: 10px;
            left: 20px;
            font-size: 0.8em;
            color: #bdc3c7;
            opacity: 0.9;
        }
        
        /* éšè—äº’åŠ¨å±‚ */
        .interactive-overlay {
            position: absolute;
            top: 60vh;
            left: 0;
            width: 100%;
            height: 40vh;
            z-index: 100;
            opacity: 0;
            cursor: pointer;
        }
        
        .interactive-panel {
            position: absolute;
            bottom: 15px;
            right: 130px;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #4ecdc4;
            display: none;
            z-index: 200;
        }
        
        .interactive-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            color: white;
            padding: 5px 10px;
            margin: 3px 0;
            cursor: pointer;
            font-size: 0.8em;
            display: block;
            width: 100%;
        }
        
        .embedded-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .speaking {
            animation: textGlow 2s ease-in-out infinite;
        }
        
        @keyframes textGlow {
            0%, 100% { 
                text-shadow: 0 0 5px rgba(255, 255, 255, 0.4);
            }
            50% { 
                text-shadow: 0 0 12px rgba(255, 255, 255, 0.8),
                           0 0 20px rgba(78, 205, 196, 0.5);
            }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }
    </style>
</head>
<body>
    <div class="mobile-live-container">
        <!-- ä¸Šéƒ¨ï¼šäº¤æ˜“çœ‹æ¿ (60%) -->
        <div class="trading-section">
            <iframe 
                class="embedded-frame" 
                id="tradingIframe"
                src="https://trading-live-widget.vercel.app/"
                allow="autoplay">
            </iframe>
            
            <!-- é»‘è‰²é®ç½©æ–¹å— -->
            <div class="mask-overlay" id="maskOverlay">
                <div class="mask-controls">
                    <button class="mask-btn" onclick="toggleMaskOpacity()">é€æ˜åº¦</button>
                    <button class="mask-btn" onclick="resetMask()">é‡ç½®</button>
                    <button class="mask-btn" onclick="toggleMask()">éšè—</button>
                </div>
            </div>
        </div>
        
        <!-- ä¸­éƒ¨ï¼šæ–°é—»æ»šåŠ¨æ¡ (6%) -->
        <div class="news-section">
            <div class="news-scroll-container">
                <div class="news-content" id="newsContent">
                    <!-- æ–°é—»å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- ä¸‹éƒ¨ï¼šå†…å®¹åŒºåŸŸ (34%) -->
        <div class="content-section">
            <!-- é˜³æ˜ä¾ æ ‡é¢˜ - å·¦ä¸Šè§’ -->
            <div class="saying-header">
                <div class="saying-title">é˜³æ˜ä¾ æ¯æ—¥ä¸€è¯´</div>
            </div>
            
            <!-- ä¸»è¦å†…å®¹ -->
            <div class="saying-content" id="sayingContent">
                <!-- æ¯æ—¥ä¸€è¯´å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- é˜³æ˜ä¾ å¤´åƒ -->
            <div class="ai-character">
                <div class="ai-avatar">
                    <img class="ai-image" id="aiAvatar" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3" alt="é˜³æ˜ä¾ ">
                </div>
                <div class="ai-name">é˜³æ˜ä¾ </div>
            </div>
            
            <!-- è¯­éŸ³çŠ¶æ€ -->
            <div class="speech-status" id="speechStatus">
                ğŸ™ï¸ AIè¯­éŸ³æ’­æŠ¥å‡†å¤‡ä¸­...
            </div>
        </div>
        
        <!-- éšè—äº’åŠ¨å±‚ -->
        <div class="interactive-overlay" id="interactiveOverlay"></div>
        <div class="interactive-panel" id="interactivePanel">
            <button class="interactive-btn" id="bgMusicBtn" onclick="toggleBackgroundMusic()">ğŸµ èƒŒæ™¯éŸ³ä¹</button>
            <button class="interactive-btn" id="relaxMusicBtn" onclick="toggleRelaxMusic()">ğŸµ è½»æ¾éŸ³ä¹</button>
            <button class="interactive-btn" onclick="toggleSpeech()">ğŸ¤ è¯­éŸ³å¼€å…³</button>
            <button class="interactive-btn" onclick="changeTopic()">ğŸ”„ åˆ‡æ¢è¯é¢˜</button>
            <button class="interactive-btn" onclick="refreshContent()">ğŸ”„ åˆ·æ–°å†…å®¹</button>
            <button class="interactive-btn" onclick="changeAvatar()">ğŸ–¼ï¸ æ›´æ¢å¤´åƒ</button>
        </div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            tradingBoardUrl: "https://trading-live-widget.vercel.app/",
            contentUpdateUrl: "",
            autoPlay: true
        };

        // éŸ³ä¹é…ç½®
        const MUSIC_CONFIG = {
            // èƒŒæ™¯éŸ³ä¹ - æŠ•ç¥¨å¤šçš„éŸ³ä¹
            backgroundMusic: [
                "https://cdn.pixabay.com/download/audio/2021/11/18/audio_2d89f2e4f7.mp3?filename=epic-cinematic-trailer-112623.mp3",
                "https://cdn.pixabay.com/download/audio/2022/01/18/audio_9d0c0a8c5c.mp3?filename=cinematic-trailer-112624.mp3",
                "https://cdn.pixabay.com/download/audio/2021/11/25/audio_1d07b4f6a5.mp3?filename=epic-motivational-cinematic-trailer-112716.mp3"
            ],
            // è½»æ¾éŸ³ä¹
            relaxMusic: [
                "https://cdn.pixabay.com/download/audio/2021/10/21/audio_7c3fbde2b6.mp3?filename=relaxing-piano-112623.mp3",
                "https://cdn.pixabay.com/download/audio/2022/01/18/audio_9a3a1e9c3b.mp3?filename=ambient-piano-112624.mp3",
                "https://cdn.pixabay.com/download/audio/2021/11/25/audio_c5c3c1b8a7.mp3?filename=calm-meditation-112716.mp3"
            ]
        };

        // AIå¤´åƒåº“ - ä½¿ç”¨Unsplashçš„çœŸå®äººç‰©ç…§ç‰‡
        const avatarLibrary = [
            "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3", // é’å¹´ç”·æ€§1
            "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3", // é’å¹´ç”·æ€§2
            "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3", // é’å¹´ç”·æ€§3
            "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3", // é’å¹´ç”·æ€§4
            "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop&crop=face&fp-x=0.5&fp-y=0.5&fp-z=1&facepad=3"  // é’å¹´ç”·æ€§5
        ];

        // é˜³æ˜ä¾ æ¯æ—¥ä¸€è¯´å†…å®¹åº“ - æ›´é•¿çš„å†…å®¹
        const dailySayings = [
            "è§‚å¸‚å¦‚è§‚å¿ƒï¼Œå¸‚åœºçš„æ¯ä¸€æ¬¡æ³¢åŠ¨éƒ½æ˜¯æŠ•èµ„è€…æƒ…ç»ªçš„é›†ä½“æ˜ å°„ã€‚çœŸæ­£çš„æ™ºæ…§ä¸åœ¨äºé¢„æµ‹æ¶¨è·Œï¼Œè€Œåœ¨äºç†è§£å¸‚åœºèƒŒåçš„å¿ƒç†é€»è¾‘ï¼Œåœ¨ä¼—äººè´ªå©ªæ—¶ä¿æŒè°¨æ…ï¼Œåœ¨ä¼—äººææƒ§æ—¶çœ‹åˆ°æœºä¼šã€‚",
            "æŠ•èµ„ä¹‹é“ï¼Œè´µåœ¨å®ˆæ­£å‡ºå¥‡ã€‚å®ˆæ­£æ˜¯åšå®ˆä»·å€¼æŠ•èµ„çš„æœ¬è´¨ï¼Œä¸ä¸ºçŸ­æœŸåˆ©ç›Šæ‰€æƒ‘ï¼›å‡ºå¥‡æ˜¯åœ¨å¸‚åœºå¼‚å¸¸æ—¶æ•¢äºé€†å‘æ€è€ƒã€‚åªæœ‰å¿ƒé™å¦‚æ°´ï¼Œæ‰èƒ½åœ¨å¸‚åœºçš„æƒŠæ¶›éª‡æµªä¸­ä¿æŒæ–¹å‘ã€‚",
            "æ•°å­—èµ„äº§çš„ä¸–ç•Œå¦‚åŒæµ©ç€šæ˜Ÿæ²³ï¼Œæ—¢æœ‰ç’€ç’¨çš„æ˜æ˜Ÿé¡¹ç›®ï¼Œä¹Ÿæœ‰è½¬ç¬å³é€çš„æµæ˜Ÿã€‚çœŸæ­£çš„ä»·å€¼æŠ•èµ„è€…æ‡‚å¾—åŒºåˆ†å™ªéŸ³ä¸ä¿¡å·ï¼Œåœ¨æŠ€æœ¯é©æ–°ä¸å¸‚åœºæ³¡æ²«ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚",
            "åŒºå—é“¾æŠ€æœ¯æ­£åœ¨é‡å¡‘ä¿¡ä»»çš„åŸºçŸ³ï¼Œæ™ºèƒ½åˆçº¦è®©æ‰¿è¯ºå˜å¾—ä¸å¯ç¯¡æ”¹ã€‚è¿™ä¸ä»…æ˜¯æŠ€æœ¯çš„è¿›æ­¥ï¼Œæ›´æ˜¯å•†ä¸šæ–‡æ˜çš„è¿›åŒ–ï¼Œè®©è¯šä¿¡ä»é“å¾·çº¦æŸå˜ä¸ºæŠ€æœ¯ä¿éšœã€‚",
            "å¸‚åœºæƒ…ç»ªå¦‚åŒæ½®æ±ï¼Œæœ‰æ¶¨æœ‰è½æ˜¯è‡ªç„¶è§„å¾‹ã€‚æˆåŠŸçš„æŠ•èµ„è€…ä¸æ˜¯ä¸æ½®æ±æŠ—äº‰çš„å‹‡å£«ï¼Œè€Œæ˜¯æ‡‚å¾—é¡ºåŠ¿è€Œä¸ºçš„å†²æµªè€…ï¼Œåœ¨æ¯ä¸€ä¸ªæµªå¤´æ‰¾åˆ°æœ€ä½³çš„åˆ‡å…¥æ—¶æœºã€‚",
            "é‡åŒ–äº¤æ˜“æ˜¯ç†æ€§ä¸æ•°æ®çš„å®Œç¾ç»“åˆï¼Œä½†çœŸæ­£çš„è¶…é¢æ”¶ç›Šå¾€å¾€æ¥è‡ªå¯¹å¸‚åœºäººæ€§çš„æ·±åˆ»ç†è§£ã€‚ç®—æ³•å¯ä»¥ä¼˜åŒ–æ‰§è¡Œï¼Œä½†æˆ˜ç•¥éœ€è¦äººç±»çš„æ™ºæ…§ä¸ç›´è§‰ã€‚",
            "å»ä¸­å¿ƒåŒ–é‡‘èæ­£åœ¨æ‰“ç ´ä¼ ç»Ÿé‡‘èçš„å£å’ï¼Œè®©æ¯ä¸ªäººéƒ½èƒ½æˆä¸ºè‡ªå·±è´¢å¯Œçš„çœŸæ­£ä¸»äººã€‚è¿™æ˜¯é‡‘èæ°‘ä¸»åŒ–çš„é©å‘½ï¼Œä¹Ÿæ˜¯ä¸ªäººä¸»æƒçš„é‡è¦ä½“ç°ã€‚",
            "åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œç­›é€‰æœ‰ä»·å€¼çš„ä¿¡æ¯æ¯”è·å–ä¿¡æ¯æ›´é‡è¦ã€‚æŠ•èµ„æˆåŠŸçš„å…³é”®å¾€å¾€ä¸æ˜¯çŸ¥é“å¾—æ›´å¤šï¼Œè€Œæ˜¯èƒ½å¤Ÿè¾¨åˆ«ä»€ä¹ˆæ‰æ˜¯çœŸæ­£é‡è¦çš„ã€‚"
        ];

        // æ–°é—»æ•°æ®
        const newsData = [
            { title: 'ğŸš€ æ¯”ç‰¹å¸çªç ´å…³é”®é˜»åŠ›ä½ï¼Œå¸‚åœºæƒ…ç»ªè½¬å‘ä¹è§‚', source: 'è¡Œæƒ…åˆ†æ', time: 'å®æ—¶' },
            { title: 'ğŸ’ ä»¥å¤ªåŠ2.0å‡çº§è¿›å±•é¡ºåˆ©ï¼Œç”Ÿæ€å»ºè®¾åŠ é€Ÿæ¨è¿›', source: 'æŠ€æœ¯åŠ¨æ€', time: '2åˆ†é’Ÿå‰' },
            { title: 'ğŸ¦ å…¨çƒå¤®è¡Œæ•°å­—è´§å¸ç«èµ›æ­£å¼æ‹‰å¼€åºå¹•', source: 'æ”¿ç­–è§‚å¯Ÿ', time: '5åˆ†é’Ÿå‰' },
            { title: 'ğŸ“Š DeFiæ€»é”ä»“é‡å†åˆ›æ–°é«˜ï¼Œå»ä¸­å¿ƒåŒ–é‡‘èè“¬å‹ƒå‘å±•', source: 'å¸‚åœºæ•°æ®', time: '10åˆ†é’Ÿå‰' }
        ];

        // éŸ³ä¹ç®¡ç†ç³»ç»Ÿ
        class MusicSystem {
            constructor() {
                this.backgroundAudio = null;
                this.relaxAudio = null;
                this.isBackgroundPlaying = false;
                this.isRelaxPlaying = false;
                this.currentBgIndex = 0;
                this.currentRelaxIndex = 0;
                this.bgMusicBtn = document.getElementById('bgMusicBtn');
                this.relaxMusicBtn = document.getElementById('relaxMusicBtn');
            }
            
            init() {
                // é»˜è®¤æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                this.playBackgroundMusic();
            }
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            playBackgroundMusic() {
                // å¦‚æœè½»æ¾éŸ³ä¹æ­£åœ¨æ’­æ”¾ï¼Œå…ˆåœæ­¢
                if (this.isRelaxPlaying) {
                    this.stopRelaxMusic();
                }
                
                if (!this.backgroundAudio || this.backgroundAudio.paused) {
                    this.backgroundAudio = new Audio(MUSIC_CONFIG.backgroundMusic[this.currentBgIndex]);
                    this.backgroundAudio.loop = true;
                    this.backgroundAudio.volume = 0.3;
                    
                    this.backgroundAudio.onended = () => {
                        this.currentBgIndex = (this.currentBgIndex + 1) % MUSIC_CONFIG.backgroundMusic.length;
                        this.playBackgroundMusic();
                    };
                    
                    this.backgroundAudio.play().then(() => {
                        this.isBackgroundPlaying = true;
                        this.updateButtonStates();
                    }).catch(e => {
                        console.log('èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    });
                }
            }
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            stopBackgroundMusic() {
                if (this.backgroundAudio) {
                    this.backgroundAudio.pause();
                    this.backgroundAudio.currentTime = 0;
                    this.isBackgroundPlaying = false;
                    this.updateButtonStates();
                }
            }
            
            // æ’­æ”¾è½»æ¾éŸ³ä¹
            playRelaxMusic() {
                // å¦‚æœèƒŒæ™¯éŸ³ä¹æ­£åœ¨æ’­æ”¾ï¼Œå…ˆåœæ­¢
                if (this.isBackgroundPlaying) {
                    this.stopBackgroundMusic();
                }
                
                if (!this.relaxAudio || this.relaxAudio.paused) {
                    this.relaxAudio = new Audio(MUSIC_CONFIG.relaxMusic[this.currentRelaxIndex]);
                    this.relaxAudio.loop = true;
                    this.relaxAudio.volume = 0.3;
                    
                    this.relaxAudio.onended = () => {
                        this.currentRelaxIndex = (this.currentRelaxIndex + 1) % MUSIC_CONFIG.relaxMusic.length;
                        this.playRelaxMusic();
                    };
                    
                    this.relaxAudio.play().then(() => {
                        this.isRelaxPlaying = true;
                        this.updateButtonStates();
                    }).catch(e => {
                        console.log('è½»æ¾éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    });
                }
            }
            
            // åœæ­¢è½»æ¾éŸ³ä¹
            stopRelaxMusic() {
                if (this.relaxAudio) {
                    this.relaxAudio.pause();
                    this.relaxAudio.currentTime = 0;
                    this.isRelaxPlaying = false;
                    this.updateButtonStates();
                }
            }
            
            // åˆ‡æ¢èƒŒæ™¯éŸ³ä¹
            toggleBackgroundMusic() {
                if (this.isBackgroundPlaying) {
                    this.stopBackgroundMusic();
                } else {
                    this.playBackgroundMusic();
                }
                interactiveSystem.hidePanel();
            }
            
            // åˆ‡æ¢è½»æ¾éŸ³ä¹
            toggleRelaxMusic() {
                if (this.isRelaxPlaying) {
                    this.stopRelaxMusic();
                } else {
                    this.playRelaxMusic();
                }
                interactiveSystem.hidePanel();
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonStates() {
                // æ›´æ–°èƒŒæ™¯éŸ³ä¹æŒ‰é’®
                if (this.isBackgroundPlaying) {
                    this.bgMusicBtn.innerHTML = 'â¸ï¸ èƒŒæ™¯éŸ³ä¹';
                    this.bgMusicBtn.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
                } else {
                    this.bgMusicBtn.innerHTML = 'ğŸµ èƒŒæ™¯éŸ³ä¹';
                    this.bgMusicBtn.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }
                
                // æ›´æ–°è½»æ¾éŸ³ä¹æŒ‰é’®
                if (this.isRelaxPlaying) {
                    this.relaxMusicBtn.innerHTML = 'â¸ï¸ è½»æ¾éŸ³ä¹';
                    this.relaxMusicBtn.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
                } else {
                    this.relaxMusicBtn.innerHTML = 'ğŸµ è½»æ¾éŸ³ä¹';
                    this.relaxMusicBtn.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }
            }
        }

        // é®ç½©ç³»ç»Ÿ
        class MaskSystem {
            constructor() {
                this.mask = document.getElementById('maskOverlay');
                this.isDragging = false;
                this.startX = 0;
                this.startY = 0;
                this.initialLeft = 0;
                this.initialTop = 0;
                this.isVisible = true;
                this.opacityLevel = 0.95;
            }
            
            init() {
                this.setupDragging();
                this.setupResizeObserver();
            }
            
            setupDragging() {
                this.mask.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    this.startX = e.clientX;
                    this.startY = e.clientY;
                    this.initialLeft = this.mask.offsetLeft;
                    this.initialTop = this.mask.offsetTop;
                    document.addEventListener('mousemove', this.onMouseMove.bind(this));
                    document.addEventListener('mouseup', this.onMouseUp.bind(this));
                });
            }
            
            onMouseMove(e) {
                if (!this.isDragging) return;
                e.preventDefault();
                
                const dx = e.clientX - this.startX;
                const dy = e.clientY - this.startY;
                
                const maxX = this.mask.parentElement.offsetWidth - this.mask.offsetWidth;
                const maxY = this.mask.parentElement.offsetHeight - this.mask.offsetHeight;
                
                let newLeft = Math.max(0, Math.min(maxX, this.initialLeft + dx));
                let newTop = Math.max(0, Math.min(maxY, this.initialTop + dy));
                
                this.mask.style.left = newLeft + 'px';
                this.mask.style.top = newTop + 'px';
            }
            
            onMouseUp() {
                this.isDragging = false;
                document.removeEventListener('mousemove', this.onMouseMove.bind(this));
                document.removeEventListener('mouseup', this.onMouseUp.bind(this));
            }
            
            setupResizeObserver() {
                const observer = new ResizeObserver(() => {
                    // ç¡®ä¿é®ç½©ä¸è¶…å‡ºçˆ¶å®¹å™¨è¾¹ç•Œ
                    const parentWidth = this.mask.parentElement.offsetWidth;
                    const parentHeight = this.mask.parentElement.offsetHeight;
                    const maskWidth = this.mask.offsetWidth;
                    const maskHeight = this.mask.offsetHeight;
                    
                    if (this.mask.offsetLeft + maskWidth > parentWidth) {
                        this.mask.style.left = (parentWidth - maskWidth) + 'px';
                    }
                    
                    if (this.mask.offsetTop + maskHeight > parentHeight) {
                        this.mask.style.top = (parentHeight - maskHeight) + 'px';
                    }
                });
                
                observer.observe(this.mask);
            }
            
            toggleOpacity() {
                this.opacityLevel = this.opacityLevel === 0.95 ? 0.7 : this.opacityLevel === 0.7 ? 0.5 : 0.95;
                this.mask.style.backgroundColor = `rgba(0, 0, 0, ${this.opacityLevel})`;
            }
            
            reset() {
                this.mask.style.width = '120px';
                this.mask.style.height = '60px';
                this.mask.style.left = 'auto';
                this.mask.style.top = '20px';
                this.mask.style.right = '20px';
                this.mask.style.bottom = 'auto';
                this.opacityLevel = 0.95;
                this.mask.style.backgroundColor = `rgba(0, 0, 0, ${this.opacityLevel})`;
            }
            
            toggle() {
                this.isVisible = !this.isVisible;
                this.mask.style.display = this.isVisible ? 'block' : 'none';
            }
        }

        // å†…å®¹ç®¡ç†ç³»ç»Ÿ
        class ContentManager {
            constructor() {
                this.currentSayingIndex = 0;
                this.sayings = dailySayings;
                this.currentAvatarIndex = 0;
            }
            
            getCurrentSaying() {
                return this.sayings[this.currentSayingIndex];
            }
            
            nextSaying() {
                this.currentSayingIndex = (this.currentSayingIndex + 1) % this.sayings.length;
                return this.getCurrentSaying();
            }
            
            getCurrentAvatar() {
                return avatarLibrary[this.currentAvatarIndex];
            }
            
            nextAvatar() {
                this.currentAvatarIndex = (this.currentAvatarIndex + 1) % avatarLibrary.length;
                return this.getCurrentAvatar();
            }
            
            async loadRemoteContent() {
                if (!CONFIG.contentUpdateUrl) return;
                try {
                    const response = await fetch(CONFIG.contentUpdateUrl);
                    const remoteData = await response.json();
                    if (remoteData.sayings) this.sayings = remoteData.sayings;
                    if (remoteData.news) {
                        newsData.length = 0;
                        newsData.push(...remoteData.news);
                    }
                } catch (error) {
                    console.log('ä½¿ç”¨æœ¬åœ°å†…å®¹åº“');
                }
            }
        }

        // åˆå§‹åŒ–æ–°é—»æ»šåŠ¨
        function initNewsScroll() {
            const newsContent = document.getElementById('newsContent');
            const newsItemsHTML = newsData.map(news => `
                <div class="news-item">
                    <div class="news-title">${news.title}</div>
                </div>
            `).join('');
            newsContent.innerHTML = newsItemsHTML + newsItemsHTML;
        }

        // æ›´æ–°å†…å®¹æ˜¾ç¤º
        function updateSayingDisplay() {
            const saying = contentManager.getCurrentSaying();
            document.getElementById('sayingContent').textContent = saying;
        }

        // æ›´æ–°å¤´åƒæ˜¾ç¤º
        function updateAvatarDisplay() {
            const avatarUrl = contentManager.getCurrentAvatar();
            document.getElementById('aiAvatar').src = avatarUrl;
        }

        // æ›´æ¢å¤´åƒ
        function changeAvatar() {
            contentManager.nextAvatar();
            updateAvatarDisplay();
            interactiveSystem.hidePanel();
        }

        // è¯­éŸ³åˆæˆç³»ç»Ÿ
        class SpeechSystem {
            constructor() {
                this.synth = window.speechSynthesis;
                this.isSpeaking = false;
            }
            
            speak(text) {
                if (this.isSpeaking) this.stop();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.85;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                utterance.onstart = () => {
                    this.isSpeaking = true;
                    this.updateSpeechUI(true);
                };
                
                utterance.onend = () => {
                    this.isSpeaking = false;
                    this.updateSpeechUI(false);
                };
                
                this.synth.speak(utterance);
            }
            
            stop() {
                if (this.isSpeaking) {
                    this.synth.cancel();
                    this.isSpeaking = false;
                    this.updateSpeechUI(false);
                }
            }
            
            updateSpeechUI(speaking) {
                const content = document.getElementById('sayingContent');
                const status = document.getElementById('speechStatus');
                const avatar = document.getElementById('aiAvatar');
                
                if (speaking) {
                    content.classList.add('speaking');
                    status.textContent = 'ğŸ™ï¸ è¯­éŸ³æ’­æŠ¥ä¸­...';
                    avatar.style.animation = 'float 2s ease-in-out infinite';
                } else {
                    content.classList.remove('speaking');
                    status.textContent = 'âœ… æ’­æŠ¥å®Œæˆ';
                    avatar.style.animation = 'none';
                }
            }
        }

        // äº’åŠ¨ç³»ç»Ÿ
        class InteractiveSystem {
            constructor() {
                this.isPanelVisible = false;
            }
            
            init() {
                const overlay = document.getElementById('interactiveOverlay');
                const panel = document.getElementById('interactivePanel');
                
                overlay.addEventListener('dblclick', () => {
                    this.togglePanel();
                });
                
                document.addEventListener('click', (e) => {
                    if (!panel.contains(e.target) && !overlay.contains(e.target)) {
                        this.hidePanel();
                    }
                });
            }
            
            togglePanel() {
                const panel = document.getElementById('interactivePanel');
                this.isPanelVisible = !this.isPanelVisible;
                panel.style.display = this.isPanelVisible ? 'block' : 'none';
            }
            
            hidePanel() {
                const panel = document.getElementById('interactivePanel');
                panel.style.display = 'none';
                this.isPanelVisible = false;
            }
        }

        // å…¨å±€å˜é‡
        let contentManager;
        let speechSystem;
        let interactiveSystem;
        let maskSystem;
        let musicSystem;
        let speechInterval;

        // é®ç½©æ§åˆ¶å‡½æ•°
        function toggleMaskOpacity() {
            maskSystem.toggleOpacity();
        }
        
        function resetMask() {
            maskSystem.reset();
        }
        
        function toggleMask() {
            maskSystem.toggle();
        }

        // éŸ³ä¹æ§åˆ¶å‡½æ•°
        function toggleBackgroundMusic() {
            musicSystem.toggleBackgroundMusic();
        }
        
        function toggleRelaxMusic() {
            musicSystem.toggleRelaxMusic();
        }

        // åˆå§‹åŒ–å‡½æ•°
        async function init() {
            contentManager = new ContentManager();
            speechSystem = new SpeechSystem();
            interactiveSystem = new InteractiveSystem();
            maskSystem = new MaskSystem();
            musicSystem = new MusicSystem();
            
            await contentManager.loadRemoteContent();
            initNewsScroll();
            updateSayingDisplay();
            updateAvatarDisplay();
            interactiveSystem.init();
            maskSystem.init();
            musicSystem.init(); // åˆå§‹åŒ–éŸ³ä¹ç³»ç»Ÿ
            
            if (CONFIG.autoPlay) {
                startAutoSpeech();
            }
        }

        function startAutoSpeech() {
            setTimeout(() => {
                speakCurrentSaying();
            }, 5000);
            
            speechInterval = setInterval(() => {
                changeTopic();
            }, 120000);
        }

        function speakCurrentSaying() {
            const saying = contentManager.getCurrentSaying();
            speechSystem.speak(saying);
        }

        function toggleSpeech() {
            if (speechSystem.isSpeaking) {
                speechSystem.stop();
                clearInterval(speechInterval);
            } else {
                speakCurrentSaying();
                speechInterval = setInterval(() => {
                    changeTopic();
                }, 120000);
            }
            interactiveSystem.hidePanel();
        }

        function changeTopic() {
            speechSystem.stop();
            contentManager.nextSaying();
            updateSayingDisplay();
            setTimeout(() => {
                speakCurrentSaying();
            }, 1000);
            interactiveSystem.hidePanel();
        }

        async function refreshContent() {
            await contentManager.loadRemoteContent();
            initNewsScroll();
            updateSayingDisplay();
            interactiveSystem.hidePanel();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
